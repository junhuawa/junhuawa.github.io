---
layout: post
title: "Git Notes"
date: 2016-09-18
category: "misc" 
tags: [git]
---

### Git push need username, password, how to avoid?

Solution 1:

A common mistake is cloning using the default (HTTPS) instead of SSH. You can correct this by going to your repository, 
clicking the ssh button left to the URL field and updating the URL of your origin remote like this:

git remote set-url origin git@github.com:username/repo.git


Solution 2: 

git push https://username:password@myrepository.biz/file.git --all

in this case https://username:password@myrepository.biz/file.git replace the origin in git push origin --all

To see more options for git push, try git help push

**Attention:**
In our company, use ssh URL instead of HTTPS URL does't work because the port of ssh have been disable by company's firewall.

### To see your repo URL, run:

git remote show origin


Git add/create patch in the BSP:
git status
git add Makefile
git commit -s -m "extraversion"// Commit the change and add signed-off-by line to the commit.

### Create last 2 commits' patch in the /tmp directory:

git format-patch -o /tmp HEAD^^

### Import your patches to the linux kernel:

git am /tmp/0001-extraversion.patch

git am /tmp/0002-extraversion.txt.patch

### apply the patch, but not commit it to the git repo.

git apply *.patch

Then, can put the patches to a template and reference them in a .scc file. for example:

$ cp /tmp/*extraversion*.patch \
$HOME/custom_layer/feature/templates/my_changes/linux/
Create an extraversion.scc file, and add below lines:
patch 0001-extraversion.patch
patch 0002-extraversion.txt.patch
$HOME/custom_layer/feature/templates/my_changes/linux/extraversion.scc

### Show changes to the code from branch intel_xeon_c600_pch to nsn_cpvc-standard

git whatchanged intel_xeon_c600_pch-standard..nsn_cpvc-standard

### View a summary of changes:

git log --pretty=oneline --abbrev-commit kernel_type..bsp -kernel_type

git log --pretty=oneline --abbrev-commit standard..nsn_cpvc-standard

### View a Combined diff of Source Code Changes

git diff kernel_type..bsp-kernel_type

git diff standard..common_pc-standard

### View the Change History of a Particular File

git whatchanged path_to_file

git whatchanged Makefile

### Use the following command to see the changes for a particular branch:

git show tag or branch

git reset --hard HEAD^

If you skip all the generated binaries and the dlls and heavy things in the repository then it shouldn't have a problem with optimization.

git config --global gc.auto 0

[junhuawa@Tesla]$git am ~/tmp/0001-add-test-msg.patch

    Applying: add test msg
    Auto packing the repository for optimum performance. You may also
    run "git gc" manually. See "git help gc" for more information.
    Counting objects: 7, done.
    Delta compression using up to 24 threads.
    Compressing objects: 100% (7/7), done.
    Writing objects: 100% (7/7), done.
    Total 7 (delta 1), reused 0 (delta 0)

    Checking connectivity: 3797750, done.

### Git cmd:
[junhuawa@Tesla]$git log  17ef73f8 > /tmp/log_git.txt

[junhuawa@Tesla]$git format-patch  -s a5c606bc8..17ef73f8

0001-random-make-add_interrupt_randomness-do-something-sa.patch

### How to export a Git project

git archive master | gzip > latest.tgz

git config --global alias.lgb "log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset%n' --abbrev-commit --date=relative --branches"

git lgb

Show kernel branch tree:

git log --graph --simplify-by-decoration --pretty=format:'%d' --all

### Extract the code from git repo to a file in tar format:

git archive HEAD --format=tar  -o ~/linux-2.6.34.15.tar

Pushes your changes upstream
Git will reject pushes if newer changes exist on remote.
Good practice: Pull then Push

### Push code to the server:

 git push origin HEAD:refs/for/master

### My Logs

git remote set-url origin git@github.com:junhuawa/junhuawa.github.io.git

[junhuawa@Tesla junhuawa.github.io]$ git remote set-url origin https://github.com/junhuawa/

junhuawa.github.io.git

[junhuawa@Tesla junhuawa.github.io]$ git remote show origin

    * remote origin
      Fetch URL: https://github.com/junhuawa/junhuawa.github.io.git
      Push  URL: https://github.com/junhuawa/junhuawa.github.io.git
      HEAD branch: master
      Remote branch:
        master tracked
      Local branch configured for 'git pull':
        master merges with remote master
      Local ref configured for 'git push':
        master pushes to master (fast-forwardable)
        
[junhuawa@Tesla junhuawa.github.io]$ 

### Show git tag description
    git show ${TAG}
    

1. Git fall back to a old commit position

    git reset --hard (commit id or HEAD^^...)

2. Show the history commit which have been masked

    git reflog

3. Git reset to a masked commit

    git reset --hard (masked commit id)

### git reflog
一个简单的git log命令可以为你展示最后一次commit，以及它的父亲，还有它父亲的父亲等等。而git reflog则列出了head曾经指向过的一系列commit。要明白它们只存在于你本机中；而不是你的版本仓库的一部分，也不包含在push和merge操作中。

### Remove a local branch

    git branch -d LRC

#### git pull and FETCH_HEAD
In its default mode, git pull is shorthand for git fetch followed by git merge
FETCH_HEAD.

FETCH_HEAD is a short-lived ref, to keep track of what has just been fetched from the remote repository. git pull first invokes git fetch, in normal cases fetching a branch from the remote; FETCH_HEAD points to the tip of this branch (it stores the SHA1 of the commit, just as branches do). git pull then invokes git merge, merging FETCH_HEAD into the current branch.

The result is exactly what you'd expect: the commit at the tip of the appropriate remote branch is merged into the commit at the tip of your current branch.

This is a bit like doing git fetch without arguments (or git remote update), updating all your remote branches, then running git merge origin/<branch>, but using FETCH_HEAD internally instead to refer to whatever single ref was fetched, instead of needing to name things.

#### git merge

需要merge时，首先从server上pull下来最新的代码，这时候会将我的改动放到一个cache里，等我修改好conflicts之后，再用git rebase --continue, 这样就会吧我的change放到最新的代码之上。

git push origin HEAD:refs/for/master 将代码push到gerrit去review

HEAD:refs/heads/master 是直接将代码push到仓库里面，这个是不允许的。

change id 是专门为gerrit review所引进的，每一次commit都会调用hook。
